# See reference docs at
# https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions
name: ci
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - name: Clone the repo
        uses: actions/checkout@v2
      # https://github.com/bahmutov/npm-install
      - name: Install deps
        uses: bahmutov/npm-install@v1
      - name: Test
        run: node --version; yarn test
        env:
          # bitbox02-api-go.js, generated by gopherjs from api-go, is quite
          # large and requires extra heap space to be able to run tests.
          NODE_OPTIONS: --max-old-space-size=16384
      - name: Transpilation
        run: npm run transpile; git diff --quiet
